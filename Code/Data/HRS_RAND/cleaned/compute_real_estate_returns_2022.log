----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/com
> pute_real_estate_returns_2022.log
  log type:  text
 opened on:  25 Sep 2025, 09:45:13

. 
. set more off

. 
. * ---------------------------------------------------------------------
. * Note: Prerequisite scripts must be run first:
. * - extract_household_2020_ret_calc_end
. * - extract_household_2022_ret_calc_start  
. * - merge_2020_2022
. * - compute_int_inc_div_2020_2022
. * - compute_net_inv_flows_2020_2022
. * - compute_debt_payments_2020_2022
. * - compute_cap_gains_2020_2022
. * - compute_beg_per_net_worth_2020_2022
. * ---------------------------------------------------------------------
. 
. local master "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/
> hrs_rand_2020_2022_master.dta"

. capture confirm file "`master'"

. if _rc {
.     di as error "ERROR: master file not found -> `master'"
.     exit 198
. }

. 
. use "`master'", clear

. di as txt "Using master file: `master'"
Using master file: /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/clean
> ed/hrs_rand_2020_2022_master.dta

. 
. * ---------------------------------------------------------------------
. * Raw variable locals (align with compute_int_inc_div_2020_2022.do)
. * ---------------------------------------------------------------------
. local f2022_re   sq139

. local a2022_re   sq141

. 
. * ---------------------------------------------------------------------
. * Define real estate sample
. * Baseline: real estate values in both years (sq134 and rq134)
. * Augmented: OR any numerator signal (rental income amount+frequency OR any flow component)
. * ---------------------------------------------------------------------
. di as txt "=== Defining real estate sample ==="
=== Defining real estate sample ===

. 
. * Check for real estate in both years (sq134 and rq134)
. gen byte has_re_both = !missing(sq134) & !missing(rq134)

. 
. * Exposure via numerator components present (raw checks)
. * Rental income exposure: amount present AND mapped frequency multiplier present
. gen byte re_exposure = 0

. replace re_exposure = 1 if !missing(`a2022_re') & !missing(`f2022_re'_mult)
(492 real changes made)

. * Real estate flow exposure: any of buy (sr030), sell (sr035), or improvements (sr045)
. replace re_exposure = 1 if !missing(sr030) | !missing(sr035) | !missing(sr045)
(147 real changes made)

. 
. * Real estate sample: baseline OR exposure
. gen byte re_sample = has_re_both | re_exposure

. 
. * Report sample statistics
. di as txt "Sample definition results:"
Sample definition results:

. tab re_sample, missing

  re_sample |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     13,685       94.76       94.76
          1 |        757        5.24      100.00
------------+-----------------------------------
      Total |     14,442      100.00

. quietly count if re_sample == 1

. local n_re_sample = r(N)

. quietly count

. local n_total = r(N)

. di as txt "Households in real estate sample: `n_re_sample' out of `n_total' (" %4.1f 100*`n_
> re_sample'/`n_total' "%)"
Households in real estate sample: 757 out of 14442 ( 5.2%)

. 
. * Breakdown by asset type
. di as txt "Breakdown by asset type:"
Breakdown by asset type:

. di as txt "Households with real estate in both years:"
Households with real estate in both years:

. tab has_re_both, missing

has_re_both |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     14,042       97.23       97.23
          1 |        400        2.77      100.00
------------+-----------------------------------
      Total |     14,442      100.00

. di as txt "Additional inclusions due to numerator exposure:"
Additional inclusions due to numerator exposure:

. tab re_exposure if !has_re_both, missing

re_exposure |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     13,685       97.46       97.46
          1 |        357        2.54      100.00
------------+-----------------------------------
      Total |     14,042      100.00

. 
. * ---------------------------------------------------------------------
. * Denominator components
. * ---------------------------------------------------------------------
. di as txt "=== Computing denominator components ==="
=== Computing denominator components ===

. 
. * Total beginning period net worth
. capture drop A_2020

. gen double A_2020 = networth_A2020 if re_sample
(13,826 missing values generated)

. 
. * Total net investment flows (treat missing as 0 within sample)
. capture drop F_2022

. gen double F_2022 = flow_total_2022 if re_sample
(13,984 missing values generated)

. replace F_2022 = 0 if missing(F_2022) & re_sample
(299 real changes made)

. 
. * Final denominator: A_2020 + 0.5*F_2022
. capture drop denom_re_2022

. gen double denom_re_2022 = A_2020 + 0.5*F_2022 if re_sample
(13,826 missing values generated)

. 
. * Apply denominator threshold (≥$10k)
. gen byte denom_re_above_10k = denom_re_2022 >= 10000 if re_sample
(13,685 missing values generated)

. replace re_sample = re_sample & denom_re_above_10k
(25 real changes made)

. 
. * Report final sample restriction results
. di as txt "Final sample restriction results:"
Final sample restriction results:

. quietly count if re_sample == 1

. local n_final_sample = r(N)

. di as txt "Final sample size after denominator threshold (≥$10k): `n_final_sample'"
Final sample size after denominator threshold (≥$10k): 732

. di as txt "Observations dropped due to negative/small denominators: `=`n_re_sample'-`n_final
> _sample''"
Observations dropped due to negative/small denominators: 25

. 
. * ---------------------------------------------------------------------
. * Numerator components
. * ---------------------------------------------------------------------
. di as txt "=== Computing numerator components ==="
=== Computing numerator components ===

. 
. * 1) Rental income (yc_re_2022)
. capture drop yc_re_2022

. gen double yc_re_2022 = int_re_2022 if re_sample
(13,966 missing values generated)

. replace yc_re_2022 = 0 if missing(yc_re_2022) & re_sample
(256 real changes made)

. 
. * 2) Capital gains (cg_re_2022) - use existing variable, treat missing as 0 within sample
. capture drop cg_re_2022_temp

. gen double cg_re_2022_temp = cg_re_2022 if re_sample
(14,047 missing values generated)

. replace cg_re_2022_temp = 0 if missing(cg_re_2022_temp) & re_sample
(337 real changes made)

. capture drop cg_re_2022

. rename cg_re_2022_temp cg_re_2022

. 
. * 3) Net investment flows (F_re_2022) - treat missing as 0 within sample
. capture drop F_re_2022

. gen double F_re_2022 = flow_re_2022 if re_sample
(14,182 missing values generated)

. replace F_re_2022 = 0 if missing(F_re_2022) & re_sample
(472 real changes made)

. 
. * ---------------------------------------------------------------------
. * Component summaries and diagnostics
. * ---------------------------------------------------------------------
. di as txt "=== Component summaries ==="
=== Component summaries ===

. 
. di as txt "Rental income (yc_re_2022) summary:"
Rental income (yc_re_2022) summary:

. summarize yc_re_2022 if re_sample, detail

                         yc_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs                 732
25%            0              0       Sum of wgt.         732

50%         9600                      Mean           26639.49
                        Largest       Std. dev.      63864.68
75%        24120         372000
90%        60000         504000       Variance       4.08e+09
95%       118800         600000       Skewness       7.259176
99%       288000         960000       Kurtosis        81.4785

. 
. di as txt "Capital gains (cg_re_2022) summary:"
Capital gains (cg_re_2022) summary:

. summarize cg_re_2022 if re_sample, detail

                         cg_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%      -990000      -1.47e+08
 5%      -250000       -3400000
10%       -50000       -2600000       Obs                 732
25%            0       -2500000       Sum of wgt.         732

50%            0                      Mean          -99917.73
                        Largest       Std. dev.       5499358
75%        50000        3310000
90%       250000        5300000       Variance       3.02e+13
95%       700000        9300000       Skewness      -26.25427
99%      2385000       1.23e+07       Kurtosis       704.1753

. 
. di as txt "Real estate flows (F_re_2022) summary:"
Real estate flows (F_re_2022) summary:

. summarize F_re_2022 if re_sample, detail

                          F_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%      -790000       -6400000
 5%      -215000       -1500000
10%       -50000       -1200000       Obs                 732
25%            0       -1040000       Sum of wgt.         732

50%            0                      Mean           2514.855
                        Largest       Std. dev.      347104.3
75%            0        1700000
90%        75000        1750000       Variance       1.20e+11
95%       200000        2170000       Skewness      -6.558175
99%      1000000        3500000       Kurtosis       178.4926

. 
. di as txt "Final denominator (A_2020 + 0.5*F_2022) summary:"
Final denominator (A_2020 + 0.5*F_2022) summary:

. summarize denom_re_2022 if re_sample, detail

                        denom_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%        47000          10750
 5%       119000          12200
10%       180000          16000       Obs                 591
25%       324400          28000       Sum of wgt.         591

50%       740000                      Mean            6723782
                        Largest       Std. dev.      1.30e+08
75%      1590000       1.30e+07
90%      3400600       1.35e+07       Variance       1.68e+16
95%      4972500       1.45e+07       Skewness       24.24081
99%     1.14e+07       3.15e+09       Kurtosis       588.7453

. 
. * Cross-tabulation of component presence
. di as txt "Component presence patterns:"
Component presence patterns:

. quietly count if !missing(yc_re_2022) & re_sample

. di as txt "  yc_re_2022 non-missing: " r(N)
  yc_re_2022 non-missing: 732

. quietly count if !missing(cg_re_2022) & re_sample

. di as txt "  cg_re_2022 non-missing: " r(N)
  cg_re_2022 non-missing: 732

. quietly count if !missing(F_re_2022) & re_sample

. di as txt "  F_re_2022 non-missing: " r(N)
  F_re_2022 non-missing: 732

. quietly count if !missing(A_2020) & re_sample

. di as txt "  A_2020 non-missing: " r(N)
  A_2020 non-missing: 591

. quietly count if !missing(F_2022) & re_sample

. di as txt "  F_2022 non-missing: " r(N)
  F_2022 non-missing: 732

. 
. * ---------------------------------------------------------------------
. * Return calculation
. * ---------------------------------------------------------------------
. di as txt "=== Computing real estate returns ==="
=== Computing real estate returns ===

. 
. * Raw return calculation
. capture drop r_re_2022

. gen double r_re_2022 = (yc_re_2022 + cg_re_2022 - F_re_2022) / denom_re_2022 if re_sample
(13,851 missing values generated)

. 
. * Summary of raw returns
. di as txt "Raw real estate returns (r_re_2022) summary:"
Raw real estate returns (r_re_2022) summary:

. summarize r_re_2022 if re_sample, detail

                          r_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.7446809       -2.03252
 5%    -.3888219      -1.100917
10%    -.2269289             -1       Obs                 591
25%    -.0208044      -.8885201       Sum of wgt.         591

50%     .0443908                      Mean           .2330102
                        Largest       Std. dev.      1.161028
75%     .2057613         10.125
90%     .5605743       10.47455       Variance       1.347987
95%     1.032448       10.61146       Skewness       8.256736
99%     3.944316       15.34159       Kurtosis       85.87532

. 
. * Check for extreme values
. quietly count if r_re_2022 > 5 & re_sample

. di as txt "Returns > 500%: " r(N)
Returns > 500%: 146

. quietly count if r_re_2022 < -1 & re_sample

. di as txt "Returns < -100%: " r(N)
Returns < -100%: 2

. 
. * ---------------------------------------------------------------------
. * Trimming extreme values (top and bottom 5%)
. * ---------------------------------------------------------------------
. di as txt "=== Trimming extreme returns ==="
=== Trimming extreme returns ===

. 
. * Calculate percentiles for trimming
. quietly _pctile r_re_2022 if re_sample, p(5 95)

. scalar p5 = r(r1)

. scalar p95 = r(r2)

. di as txt "5th percentile: " p5
5th percentile: -.38882192

. di as txt "95th percentile: " p95
95th percentile: 1.0324484

. 
. * Create trimmed returns
. capture drop r_re_2022_trimmed

. gen double r_re_2022_trimmed = r_re_2022 if re_sample
(13,851 missing values generated)

. replace r_re_2022_trimmed = . if r_re_2022 < p5 | r_re_2022 > p95
(58 real changes made, 58 to missing)

. 
. * Summary of trimmed returns
. di as txt "Trimmed real estate returns (r_re_2022_trimmed) summary:"
Trimmed real estate returns (r_re_2022_trimmed) summary:

. summarize r_re_2022_trimmed if re_sample, detail

                      r_re_2022_trimmed
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.3519728      -.3888219
 5%    -.2586605      -.3856209
10%    -.1571429      -.3764216       Obs                 533
25%    -.0049946      -.3697641       Sum of wgt.         533

50%     .0443908                      Mean           .0924962
                        Largest       Std. dev.      .2344712
75%     .1734924       .8942985
90%     .3809524       .9444444       Variance       .0549767
95%     .6255856       .9836066       Skewness       1.178167
99%     .8861048       1.032448       Kurtosis       5.304263

. 
. quietly count if !missing(r_re_2022_trimmed) & re_sample

. di as txt "Observations after trimming: " r(N)
Observations after trimming: 533

. 
. * ---------------------------------------------------------------------
. * Top 20 returns display
. * ---------------------------------------------------------------------
. di as txt "Top 20 positive real estate returns:"
Top 20 positive real estate returns:

. gsort -r_re_2022

. list hhid rsubhh r_re_2022 yc_re_2022 cg_re_2022 F_re_2022 A_2020 F_2022 denom_re_2022 in 1/
> 20 if re_sample

     +-----------------------------------------------------------------------------------+
  1. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 542265 |      0 | 15.341593 |    33600 |   850000 |  -850000 |  538000 |  -850000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       113000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  2. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 541987 |      0 | 10.611465 |    42000 |   576000 |  -215000 |  186000 |  -215000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        78500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  3. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 546280 |      0 |  10.47455 |   288000 |        0 | -6400000 | 3838500 | -6400000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       638500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  4. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 523097 |      2 |    10.125 |        0 |   430000 |  -380000 |  460000 |  -760000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        80000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  5. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 084298 |      0 | 9.2501734 |        0 |  2960000 |        0 |  319994 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       319994                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  6. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 542402 |      0 | 3.9443155 |        0 |   650000 |  -200000 |  323000 |  -215000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       215500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  7. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 545979 |      0 | 3.8536984 |        0 |  1220000 |        0 |  316579 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       316579                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  8. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 034763 |      2 | 3.7894737 |        0 |  9300000 | -1500000 | 3600000 | -1500000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      2850000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  9. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 147589 |      0 | 3.7352232 |   372000 | 12265000 |   -65000 | 3460000 |  -118800 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      3400600                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 10. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 010451 |      0 |      3.16 |        0 |        0 |  -790000 |  655000 |  -810000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       250000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 11. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 916619 |      0 | 2.7850929 |   118800 |  2100000 |        0 |  796670 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       796670                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 12. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 501141 |      0 | 2.7813472 |    84000 |  1950000 |  -650000 | 1290000 |  -650000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       965000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 13. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 540908 |      0 |      2.64 |        0 |  1650000 |        0 |  625000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       625000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 14. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 544930 |      0 | 2.6060606 |   180000 |  1790000 | -1040000 | 1675000 | -1040000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1155000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 15. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 076637 |      0 | 2.2666667 |    72000 |  1900000 |        0 |  870000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       870000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 16. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 526238 |      0 | 2.2242991 |        0 |        0 |  -595000 |  587500 |  -640000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       267500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 17. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 544260 |      0 | 2.1749723 |    12000 |   410000 |  -560000 |  716000 |  -529000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       451500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 18. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 546141 |      0 | 1.7928571 |    10200 |    40000 |        0 |   33000 |   -10000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        28000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 19. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 541268 |      0 | 1.4159292 |        0 |        0 |  -400000 |  350000 |  -135000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       282500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 20. |   hhid | rsubhh | r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 500220 |      0 | 1.3968816 |     9600 |    92000 |   -12000 |   87324 |   -12000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        81324                                      |
     +-----------------------------------------------------------------------------------+

. 
. di as txt "Top 20 negative real estate returns:"
Top 20 negative real estate returns:

. gsort r_re_2022

. list hhid rsubhh r_re_2022 yc_re_2022 cg_re_2022 F_re_2022 A_2020 F_2022 denom_re_2022 in 1/
> 20 if re_sample

     +-----------------------------------------------------------------------------------+
  1. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 078478 |      0 | -2.0325203 |        0 |        0 |   125000 |   -1000 |  125000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        61500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  2. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 052020 |      0 | -1.1009174 |        0 |        0 |   180000 |   73500 |  180000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       163500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  3. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 544277 |      0 |         -1 |        0 |        0 |   340000 |  195000 |  290000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       340000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  4. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 908703 |      2 | -.88852006 |    24000 |  -565000 |  1065000 | 1275000 | 1065000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1807500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  5. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 529474 |      0 | -.78335688 |        0 | -2600000 |  3500000 | 6050000 | 3474000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      7787000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  6. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 905776 |      1 | -.74468085 |        0 |   -35000 |        0 |   47000 |       0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        47000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  7. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 078384 |      2 | -.74413408 |     6600 |  -403000 |   203000 |  704000 |  203000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       805500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  8. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 148085 |      0 | -.65282443 |    42000 | -1390000 |   790000 | 2875000 |  800000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      3275000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  9. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 525268 |      0 | -.64150943 |        0 |        0 |    85000 |   90000 |   85000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       132500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 10. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 918737 |      0 | -.63172414 |    50400 |  -600000 |        0 |  870000 |       0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       870000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 11. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 501948 |      0 | -.61510464 |   120000 | -2500000 |  1000000 | 4995000 | 1000000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      5495000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 12. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 501206 |      0 | -.57291441 |     9600 |  -122000 |   152000 |  402000 |  119000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       461500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 13. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 075605 |      1 |  -.5707563 |     5040 |        0 |    39000 |   40000 |   39000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        59500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 14. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 208663 |      0 | -.56648045 |     3600 |  -105000 |        0 |  179000 |       0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       179000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 15. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 544329 |      0 | -.55814815 |     7200 |  -380000 |   230000 |  960000 |  240000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1080000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 16. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 542144 |      0 | -.55662188 |        0 |        0 |   145000 |  198000 |  125000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       260500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 17. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 079194 |      1 | -.53719699 |    10800 |  -200000 |   100000 |  488100 |  100500 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       538350                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 18. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 500402 |      2 | -.53049645 |    15000 |  -519000 |   244000 | 1355000 |  110000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1410000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 19. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 050412 |      0 | -.48723069 |    14400 |  -289000 |   189000 |  857000 |  189000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       951500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 20. |   hhid | rsubhh |  r_re_2022 | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |  F_2022 |
     | 533656 |      0 | -.48598131 |        0 |  -884000 |        0 | 1817000 |    4000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1819000                                      |
     +-----------------------------------------------------------------------------------+

. 
. di as txt "Top 20 trimmed real estate returns:"
Top 20 trimmed real estate returns:

. gsort -r_re_2022_trimmed

. list hhid rsubhh r_re_2022_trimmed yc_re_2022 cg_re_2022 F_re_2022 A_2020 F_2022 denom_re_20
> 22 in 1/20 if !missing(r_re_2022_trimmed)

     +-----------------------------------------------------------------------------------+
  1. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 051228 |      0 | 1.0324484 |    30000 |   710000 |    40000 |  658000 |    40000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       678000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  2. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 042645 |      0 | .98360656 |    12000 |        0 |        0 |   13000 |    -1600 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        12200                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  3. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 178865 |      0 | .94444444 |        0 |   240000 |  -100000 |  410000 |  -100000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       360000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  4. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 535162 |      0 | .89429853 |   120000 |  1138000 |  -138000 | 1630000 |  -138000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1561000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  5. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 047683 |      0 | .88898765 |    10020 |   135000 |   -35000 |  220000 |   -35000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       202500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  6. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 540399 |      0 | .88610478 |   240000 |  2450000 | -1200000 | 4990000 | -1200000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      4390000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  7. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 541674 |      0 | .86746988 |        0 |   180000 |        0 |  210000 |    -5000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       207500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  8. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 500369 |      0 | .86367925 |    32400 |   700000 |        0 |  848000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       848000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
  9. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 541370 |      0 |  .8328125 |    26400 |   400000 |        0 |  527000 |   -30000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       512000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 10. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 529619 |      0 | .79148936 |    36000 |   150000 |        0 |  235000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       235000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 11. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 542649 |      0 |  .7804878 |    96000 |        0 |        0 |  123000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       123000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 12. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 544775 |      0 |  .7787061 |   189600 |  2385000 |  -585000 | 4350000 |  -585000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      4057500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 13. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 524198 |      0 | .77264957 |    72000 |   102000 |   -52000 |  318500 |   -52000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       292500                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 14. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 901850 |      0 | .73872761 |    78000 |  1058500 |  -358500 | 2070000 |   -92500 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      2023750                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 15. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 522254 |      0 |  .6893617 |    12000 |   150000 |        0 |  235000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       235000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 16. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 543077 |      0 | .68757481 |    37200 |   250000 |        0 |  417700 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       417700                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 17. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 527583 |      0 | .68493151 |        0 |    50000 |        0 |   73000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                        73000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 18. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 501213 |      0 | .68398268 |    90000 |   700000 |        0 | 1155000 |        0 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                      1155000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 19. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 522080 |      0 | .67728814 |     9600 |   240000 |  -150000 |  665000 |  -150000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       590000                                      |
     +-----------------------------------------------------------------------------------+

     +-----------------------------------------------------------------------------------+
 20. |   hhid | rsubhh | r_re_20~d | yc_re_~2 | cg_re_~2 | F_r~2022 |  A_2020 |   F_2022 |
     | 050631 |      0 | .66873706 |    36000 |   530000 |   -80000 | 1012000 |   -92000 |
     |-----------------------------------------------------------------------------------|
     |                                     d~e_2022                                      |
     |                                       966000                                      |
     +-----------------------------------------------------------------------------------+

. 
. * ---------------------------------------------------------------------
. * Zero-value checks
. * ---------------------------------------------------------------------
. di as txt "=== Zero-value analysis ==="
=== Zero-value analysis ===

. 
. quietly count if yc_re_2022 == 0 & re_sample

. di as txt "Households with zero rental income: " r(N)
Households with zero rental income: 263

. quietly count if cg_re_2022 == 0 & re_sample

. di as txt "Households with zero capital gains: " r(N)
Households with zero capital gains: 374

. quietly count if F_re_2022 == 0 & re_sample

. di as txt "Households with zero real estate flows: " r(N)
Households with zero real estate flows: 472

. 
. * ---------------------------------------------------------------------
. * Save results
. * ---------------------------------------------------------------------
. di as txt "=== Saving results ==="
=== Saving results ===

. 
. save "`master'", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/hrs_rand_2020_2022_mast
    > er.dta saved

. di as txt "Saved real estate return variables to master: `master'"
Saved real estate return variables to master: /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTru
> st/Code/Data/HRS_RAND/cleaned/hrs_rand_2020_2022_master.dta

. 
. * List of variables created
. di as txt "Variables created:"
Variables created:

. di as txt "  re_sample: sample indicator"
  re_sample: sample indicator

. di as txt "  A_2020: beginning period net worth"
  A_2020: beginning period net worth

. di as txt "  F_2022: total net investment flows"
  F_2022: total net investment flows

. di as txt "  denom_re_2022: final denominator"
  denom_re_2022: final denominator

. di as txt "  yc_re_2022: rental income"
  yc_re_2022: rental income

. di as txt "  cg_re_2022: capital gains"
  cg_re_2022: capital gains

. di as txt "  F_re_2022: real estate flows"
  F_re_2022: real estate flows

. di as txt "  r_re_2022: raw returns"
  r_re_2022: raw returns

. di as txt "  r_re_2022_trimmed: trimmed returns"
  r_re_2022_trimmed: trimmed returns

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/com
> pute_real_estate_returns_2022.log
  log type:  text
 closed on:  25 Sep 2025, 09:45:14
----------------------------------------------------------------------------------------------
