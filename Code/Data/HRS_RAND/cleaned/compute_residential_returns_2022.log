----------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/com
> pute_residential_returns_2022.log
  log type:  text
 opened on:  29 Sep 2025, 11:57:43

. 
. set more off

. 
. * ---------------------------------------------------------------------
. * Note: Prerequisite scripts must be run first:
. * - extract_household_2020_ret_calc_end
. * - extract_household_2022_ret_calc_start  
. * - merge_2020_2022
. * - compute_int_inc_div_2020_2022
. * - compute_net_inv_flows_2020_2022
. * - compute_debt_payments_2020_2022
. * - compute_cap_gains_2020_2022
. * - compute_beg_per_net_worth_2020_2022
. * ---------------------------------------------------------------------
. 
. local master "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/
> hrs_rand_2020_2022_master.dta"

. capture confirm file "`master'"

. if _rc {
.     di as error "ERROR: master file not found -> `master'"
.     exit 198
. }

. 
. use "`master'", clear

. di as txt "Using master file: `master'"
Using master file: /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/clean
> ed/hrs_rand_2020_2022_master.dta

. 
. * ---------------------------------------------------------------------
. * Define residential housing sample
. * Baseline: residential housing values in both years (v_res_2022 and v_res_2020)
. * Augmented: OR any flow component (buy/sell/improvements)
. * ---------------------------------------------------------------------
. di as txt "=== Defining residential housing sample ==="
=== Defining residential housing sample ===

. 
. * Check for residential housing in both years (v_res_2022 and v_res_2020)
. gen byte has_res_both = !missing(v_res_2022) & !missing(v_res_2020)

. 
. * Exposure via flow components present (raw checks)
. * Residential flow exposure: any of buy (sr007), sell (sr013), or improvements (sr024)
. gen byte res_exposure = 0

. replace res_exposure = 1 if !missing(sr007) | !missing(sr013) | !missing(sr024)
(1,684 real changes made)

. 
. * Residential sample: baseline OR exposure
. gen byte res_sample = has_res_both | res_exposure

. 
. * Report sample statistics
. di as txt "Sample definition results:"
Sample definition results:

. tab res_sample, missing

 res_sample |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      9,551       66.13       66.13
          1 |      4,891       33.87      100.00
------------+-----------------------------------
      Total |     14,442      100.00

. quietly count if res_sample == 1

. local n_res_sample = r(N)

. quietly count

. local n_total = r(N)

. di as txt "Households in residential housing sample: `n_res_sample' out of `n_total' (" %4.1
> f 100*`n_res_sample'/`n_total' "%)"
Households in residential housing sample: 4891 out of 14442 (33.9%)

. 
. * Breakdown by asset type
. di as txt "Breakdown by asset type:"
Breakdown by asset type:

. di as txt "Households with residential housing in both years:"
Households with residential housing in both years:

. tab has_res_both, missing

has_res_bot |
          h |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,125       70.11       70.11
          1 |      4,317       29.89      100.00
------------+-----------------------------------
      Total |     14,442      100.00

. di as txt "Additional inclusions due to flow exposure:"
Additional inclusions due to flow exposure:

. tab res_exposure if !has_res_both, missing

res_exposur |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      9,551       94.33       94.33
          1 |        574        5.67      100.00
------------+-----------------------------------
      Total |     10,125      100.00

. 
. * ---------------------------------------------------------------------
. * Denominator components
. * ---------------------------------------------------------------------
. di as txt "=== Computing denominator components ==="
=== Computing denominator components ===

. 
. * Total beginning period net worth
. capture drop A_2020

. gen double A_2020 = networth_A2020 if res_sample
(9,809 missing values generated)

. 
. * Total net investment flows (treat missing as 0 within sample)
. capture drop F_2022

. gen double F_2022 = flow_total_2022 if res_sample
(11,929 missing values generated)

. replace F_2022 = 0 if missing(F_2022) & res_sample
(2,378 real changes made)

. 
. * Final denominator: A_2020 + 0.5*F_2022
. capture drop denom_res_2022

. gen double denom_res_2022 = A_2020 + 0.5*F_2022 if res_sample
(9,809 missing values generated)

. 
. * Apply denominator threshold (≥$10k)
. gen byte denom_res_above_10k = denom_res_2022 >= 10000 if res_sample
(9,551 missing values generated)

. replace res_sample = res_sample & denom_res_above_10k
(185 real changes made)

. 
. * Report final sample restriction results
. di as txt "Final sample restriction results:"
Final sample restriction results:

. quietly count if res_sample == 1

. local n_final_sample = r(N)

. di as txt "Final sample size after denominator threshold (≥$10k): `n_final_sample'"
Final sample size after denominator threshold (≥$10k): 4706

. di as txt "Observations dropped due to negative/small denominators: `=`n_res_sample'-`n_fina
> l_sample''"
Observations dropped due to negative/small denominators: 185

. 
. * ---------------------------------------------------------------------
. * Numerator components
. * ---------------------------------------------------------------------
. di as txt "=== Computing numerator components ==="
=== Computing numerator components ===

. 
. * Check for required variables
. capture confirm variable cg_res_total_2022

. if _rc {
.     di as error "ERROR: cg_res_total_2022 not found. Run compute_cap_gains_2020_2022.do firs
> t."
.     exit 198
. }

. capture confirm variable flow_residences_2022

. if _rc {
.     di as error "ERROR: flow_residences_2022 not found. Run compute_net_inv_flows_2020_2022.
> do first."
.     exit 198
. }

. 
. * 1) Interest income (yc_res_2022) - always 0 for residential housing
. capture drop yc_res_2022

. gen double yc_res_2022 = 0 if res_sample
(9,736 missing values generated)

. 
. * 2) Capital gains (cg_res_2022) - use existing variable, treat missing as 0 within sample
. capture drop cg_res_2022

. gen double cg_res_2022 = cg_res_total_2022 if res_sample
(10,211 missing values generated)

. replace cg_res_2022 = 0 if missing(cg_res_2022) & res_sample
(475 real changes made)

. 
. * 3) Net investment flows (F_res_2022) - treat missing as 0 within sample
. capture drop F_res_2022

. gen double F_res_2022 = flow_residences_2022 if res_sample
(12,891 missing values generated)

. replace F_res_2022 = 0 if missing(F_res_2022) & res_sample
(3,155 real changes made)

. 
. * ---------------------------------------------------------------------
. * Component summaries and diagnostics
. * ---------------------------------------------------------------------
. di as txt "=== Component summaries ==="
=== Component summaries ===

. 
. di as txt "Interest income (yc_res_2022) summary:"
Interest income (yc_res_2022) summary:

. summarize yc_res_2022 if res_sample, detail

                         yc_res_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               4,706
25%            0              0       Sum of wgt.       4,706

50%            0                      Mean                  0
                        Largest       Std. dev.             0
75%            0              0
90%            0              0       Variance              0
95%            0              0       Skewness              .
99%            0              0       Kurtosis              .

. tabstat yc_res_2022 if res_sample, stats(n mean sd p50 min max) format(%12.2f)

    Variable |            N         Mean           SD          p50          Min          Max
-------------+------------------------------------------------------------------------------
 yc_res_2022 |      4706.00         0.00         0.00         0.00         0.00         0.00
--------------------------------------------------------------------------------------------

. 
. di as txt "Capital gains (cg_res_2022) summary:"
Capital gains (cg_res_2022) summary:

. summarize cg_res_2022 if res_sample, detail

                         cg_res_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%      -435000      -3.00e+09
 5%       -80000       -5600000
10%       -18000       -2290000       Obs               4,706
25%            0       -1605000       Sum of wgt.       4,706

50%        49000                      Mean          -558364.1
                        Largest       Std. dev.      4.37e+07
75%       113000        1800000
90%       235000        2500000       Variance       1.91e+15
95%       370000        2705000       Skewness      -68.57489
99%       880000        9090000       Kurtosis       4703.677

. tabstat cg_res_2022 if res_sample, stats(n mean sd p50 min max) format(%12.2f)

    Variable |            N         Mean           SD          p50          Min          Max
-------------+------------------------------------------------------------------------------
 cg_res_2022 |      4706.00   -558364.07  43689755.39     49000.00    -3.00e+09   9090000.00
--------------------------------------------------------------------------------------------

. 
. di as txt "Residential flows (F_res_2022) summary:"
Residential flows (F_res_2022) summary:

. summarize F_res_2022 if res_sample, detail

                         F_res_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%      -295000       -2660000
 5%       -60000       -2050000
10%       -30000       -1600000       Obs               4,706
25%        -2000       -1000000       Sum of wgt.       4,706

50%            0                      Mean           1174.504
                        Largest       Std. dev.      128706.3
75%            0        1100000
90%            0        1225000       Variance       1.66e+10
95%        69000        2000000       Skewness       3.115391
99%       450000        3500000       Kurtosis        201.872

. tabstat F_res_2022 if res_sample, stats(n mean sd p50 min max) format(%12.2f)

    Variable |            N         Mean           SD          p50          Min          Max
-------------+------------------------------------------------------------------------------
  F_res_2022 |      4706.00      1174.50    128706.34         0.00  -2660000.00   3500000.00
--------------------------------------------------------------------------------------------

. 
. di as txt "Final denominator (A_2020 + 0.5*F_2022) summary:"
Final denominator (A_2020 + 0.5*F_2022) summary:

. summarize denom_res_2022 if res_sample, detail

                       denom_res_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%        19000          10000
 5%        43000          10000
10%        69000          10000       Obs               4,448
25%       146875          10000       Sum of wgt.       4,448

50%       316475                      Mean            1383384
                        Largest       Std. dev.      4.72e+07
75%       719000       1.45e+07
90%      1526000       1.88e+07       Variance       2.23e+15
95%      2505500       2.27e+07       Skewness       66.61028
99%      5495000       3.15e+09       Kurtosis       4440.611

. 
. * Cross-tabulation of component presence
. di as txt "Component presence patterns:"
Component presence patterns:

. quietly count if !missing(yc_res_2022) & res_sample

. di as txt "  yc_res_2022 non-missing: " r(N)
  yc_res_2022 non-missing: 4706

. quietly count if !missing(cg_res_2022) & res_sample

. di as txt "  cg_res_2022 non-missing: " r(N)
  cg_res_2022 non-missing: 4706

. quietly count if !missing(F_res_2022) & res_sample

. di as txt "  F_res_2022 non-missing: " r(N)
  F_res_2022 non-missing: 4706

. quietly count if !missing(A_2020) & res_sample

. di as txt "  A_2020 non-missing: " r(N)
  A_2020 non-missing: 4448

. quietly count if !missing(F_2022) & res_sample

. di as txt "  F_2022 non-missing: " r(N)
  F_2022 non-missing: 4706

. 
. * ---------------------------------------------------------------------
. * Return calculation
. * ---------------------------------------------------------------------
. di as txt "=== Computing residential housing returns ==="
=== Computing residential housing returns ===

. 
. * Raw return calculation
. capture drop r_res_2022

. gen double r_res_2022 = (yc_res_2022 + cg_res_2022 - F_res_2022) / denom_res_2022 if res_sam
> ple
(9,994 missing values generated)

. 
. * Summary of raw returns
. di as txt "Raw residential housing returns (r_res_2022) summary:"
Raw residential housing returns (r_res_2022) summary:

. summarize r_res_2022 if res_sample, detail

                         r_res_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -1.224242      -4.925373
 5%    -.4098361      -3.611111
10%    -.1428571       -3.28849       Obs               4,448
25%     .0125301      -3.071429       Sum of wgt.       4,448

50%     .1496167                      Mean           .3917478
                        Largest       Std. dev.      1.832011
75%      .405817           26.5
90%     .8994709          26.75       Variance       3.356264
95%          1.5             47       Skewness       21.45284
99%     5.416667             74       Kurtosis       712.4693

. 
. * Check for extreme values
. quietly count if r_res_2022 > 5 & res_sample

. di as txt "Returns > 500%: " r(N)
Returns > 500%: 306

. quietly count if r_res_2022 < -1 & res_sample

. di as txt "Returns < -100%: " r(N)
Returns < -100%: 64

. 
. * ---------------------------------------------------------------------
. * Trimming extreme values (top and bottom 5%)
. * ---------------------------------------------------------------------
. di as txt "=== Trimming extreme returns ==="
=== Trimming extreme returns ===

. 
. * Calculate percentiles for trimming
. quietly _pctile r_res_2022 if res_sample, p(5 95)

. scalar p5 = r(r1)

. scalar p95 = r(r2)

. di as txt "5th percentile: " p5
5th percentile: -.40983607

. di as txt "95th percentile: " p95
95th percentile: 1.5

. 
. * Create trimmed returns
. capture drop r_res_2022_trimmed

. gen double r_res_2022_trimmed = r_res_2022 if res_sample
(9,994 missing values generated)

. replace r_res_2022_trimmed = . if r_res_2022 < p5 | r_res_2022 > p95
(442 real changes made, 442 to missing)

. 
. * Summary of trimmed returns
. di as txt "Trimmed residential housing returns (r_res_2022_trimmed) summary:"
Trimmed residential housing returns (r_res_2022_trimmed) summary:

. summarize r_res_2022_trimmed if res_sample, detail

                     r_res_2022_trimmed
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.3380084      -.4098361
 5%    -.1639344      -.4078014
10%    -.0412201      -.4068025       Obs               4,006
25%     .0268456      -.4054054       Sum of wgt.       4,006

50%     .1498503                      Mean           .2375622
                        Largest       Std. dev.      .3278449
75%     .3738318       1.497436
90%     .6835938            1.5       Variance       .1074823
95%     .9480627            1.5       Skewness       1.335939
99%     1.335827            1.5       Kurtosis       5.094397

. 
. quietly count if !missing(r_res_2022_trimmed) & res_sample

. di as txt "Observations after trimming: " r(N)
Observations after trimming: 4006

. 
. * ---------------------------------------------------------------------
. * Top 20 returns display
. * ---------------------------------------------------------------------
. di as txt "Top 20 positive residential housing returns:"
Top 20 positive residential housing returns:

. gsort -r_res_2022

. list hhid rsubhh r_res_2022 yc_res_2022 cg_res_2022 F_res_2022 A_2020 F_2022 denom_res_2022 
> in 1/20 if res_sample

     +---------------------------------------------------------------------------------+
  1. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 173152 |      0 |        74 |        0 |  1050000 |  -800000 | 425000 | -800000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       25000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  2. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 056038 |      1 |        47 |        0 |   470000 |        0 |  10000 |       0 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       10000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  3. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 543275 |      0 |     26.75 |        0 |   765000 |  -305000 | 192500 | -305000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       40000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  4. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 532858 |      0 |      26.5 |        0 |   205000 |   -60000 |  40000 |  -60000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       10000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  5. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 527580 |      0 | 19.067406 |        0 |   741131 |        0 |  38869 |       0 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       38869                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  6. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 500570 |      0 | 16.666667 |        0 |        0 |  -275000 | 149000 | -265000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       16500                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  7. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 537251 |      0 |     16.08 |        0 |   690000 |  -315000 | 220000 | -315000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       62500                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  8. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 918669 |      0 | 15.300142 |        0 |   186000 |   -62000 |  47209 |  -62000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       16209                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
  9. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 544898 |      0 | 15.063625 |        0 |   851090 |  -354000 | 257000 | -354000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       80000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 10. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 501255 |      0 | 14.894737 |        0 |   223000 |   -60000 |  54000 |  -70000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       19000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 11. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 044977 |      2 | 14.818182 |        0 |  1630000 |        0 | 110000 |       0 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                      110000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 12. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 523097 |      2 |    13.625 |        0 |   710000 |  -380000 | 460000 | -760000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       80000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 13. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 543034 |      1 | 12.782609 |        0 |   288000 |    -6000 |  26000 |   -6000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       23000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 14. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 904135 |      0 |        12 |        0 |   180000 |        0 |  15000 |       0 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       15000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 15. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 123704 |      0 | 11.937984 |        0 |   190500 |   -40500 |  39600 |  -40500 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       19350                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 16. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 544252 |      0 | 10.952381 |        0 |   115000 |        0 |   8000 |    5000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       10500                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 17. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 528362 |      0 | 10.712074 |        0 |   248000 |   -98000 |  81300 |  -98000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       32300                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 18. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 545114 |      0 | 10.693381 |        0 |   340000 |   -40000 |  55536 |  -40000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       35536                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 19. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 544888 |      0 |      10.5 |        0 |   105000 |        0 |  10000 |       0 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       10000                                     |
     +---------------------------------------------------------------------------------+

     +---------------------------------------------------------------------------------+
 20. |   hhid | rsubhh | r_res_2~2 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 541948 |      0 | 10.206897 |        0 |   515000 |  -225000 | 185000 | -225000 |
     |---------------------------------------------------------------------------------|
     |                                    denom_..                                     |
     |                                       72500                                     |
     +---------------------------------------------------------------------------------+

. 
. di as txt "Top 20 negative residential housing returns:"
Top 20 negative residential housing returns:

. gsort r_res_2022

. list hhid rsubhh r_res_2022 yc_res_2022 cg_res_2022 F_res_2022 A_2020 F_2022 denom_res_2022 
> in 1/20 if res_sample

     +----------------------------------------------------------------------------------+
  1. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 531180 |      0 | -4.9253731 |        0 |        0 |   330000 | -93000 |  320000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        67000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  2. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 187575 |      1 | -3.6111111 |        0 |  -280000 |   -20000 |  82000 |  -20000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        72000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  3. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 544707 |      0 | -3.2884903 |        0 |  -220000 |        0 |  66900 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        66900                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  4. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 073108 |      0 | -3.0714286 |        0 |        0 |    86000 | -15000 |   86000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        28000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  5. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 501328 |      0 | -2.7055151 |        0 | -1090000 |   600000 | 325650 |  598000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       624650                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  6. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 521068 |      2 | -2.4583333 |        0 |        0 |   177000 | -16500 |  177000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        72000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  7. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 906307 |      7 | -2.4289406 |        0 | -1200000 |  3500000 | 185000 | 3500000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                      1935000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  8. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 543224 |      0 | -2.3517382 |        0 |   -65000 |   165000 |  15300 |  165000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        97800                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  9. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 542617 |      0 | -2.1896552 |        0 |        0 |   127000 |  -5500 |  127000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        58000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 10. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 186563 |      0 | -2.1712062 |        0 |   -72000 |   207000 |  25000 |  207000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       128500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 11. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 502751 |      0 | -2.1026226 |        0 |  -606000 |   316000 | 280500 |  316000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       438500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 12. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 500277 |      2 | -2.0916335 |        0 |  -225000 |   300000 | 101000 |  300000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       251000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 13. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 916112 |      0 | -1.9545804 |        0 |  -834500 |   435000 | 432000 |  435000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       649500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 14. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 501284 |      0 | -1.9417476 |        0 |   100000 |   240000 | -82900 |  310000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        72100                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 15. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 525290 |      0 | -1.9259259 |        0 |  -156000 |        0 |  81000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        81000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 16. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 527592 |      0 | -1.8951613 |        0 |  -775000 |   400000 | 420000 |  400000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       620000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 17. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 502750 |      2 | -1.8778281 |        0 |  -350000 |   480000 | 202000 |  480000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       442000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 18. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 501733 |      0 | -1.8726592 |        0 |        0 |   100000 |   3400 |  100000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        53400                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 19. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 537521 |      1 | -1.7682927 |        0 |  -145000 |   145000 |  93000 |  142000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       164000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 20. |   hhid | rsubhh | r_res_2022 | yc_res~2 | cg_res.. | F_res_~2 | A_2020 |  F_2022 |
     | 501677 |      0 | -1.7415128 |        0 |  -934000 |   528000 | 558000 |  563000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       839500                                     |
     +----------------------------------------------------------------------------------+

. 
. di as txt "Top 20 trimmed residential housing returns:"
Top 20 trimmed residential housing returns:

. gsort -r_res_2022_trimmed

. list hhid rsubhh r_res_2022_trimmed yc_res_2022 cg_res_2022 F_res_2022 A_2020 F_2022 denom_r
> es_2022 in 1/20 if !missing(r_res_2022_trimmed)

     +----------------------------------------------------------------------------------+
  1. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 543659 |      0 |       1.5 |        0 |   150000 |        0 |  100000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       100000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  2. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 018075 |      0 |       1.5 |        0 |    75000 |        0 |   50000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        50000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  3. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 500631 |      0 |       1.5 |        0 |   115000 |   -20000 |  100000 |  -20000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        90000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  4. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 541727 |      0 | 1.4974359 |        0 |   715000 |   -15000 |  495000 |  -15000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       487500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  5. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 543621 |      0 | 1.4942529 |        0 |   110000 |   -20000 |   97000 |  -20000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        87000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  6. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 914267 |      0 | 1.4935065 |        0 |   115000 |        0 |   77000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        77000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  7. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 545447 |      0 | 1.4927536 |        0 |   417000 |  -304000 |  605000 | -244000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       483000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  8. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 501243 |      0 | 1.4925373 |        0 |    20000 |        0 |   13400 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        13400                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
  9. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 021583 |      0 | 1.4843305 |        0 |   513000 |    -8000 |  355000 |   -8000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       351000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 10. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 546314 |      1 | 1.4831461 |        0 |   126000 |    -6000 |   92000 |   -6000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        89000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 11. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 501077 |      0 | 1.4807502 |        0 |    30000 |        0 |   20260 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        20260                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 12. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 540652 |      0 | 1.4782609 |        0 |   170000 |        0 |  115000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       115000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 13. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 908099 |      0 | 1.4761905 |        0 |   166000 |   -20000 |  136000 |  -20000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       126000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 14. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 176166 |      0 | 1.4745763 |        0 |   174000 |        0 |  118000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       118000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 15. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 906277 |      0 | 1.4537031 |        0 |   176074 |   -10000 |  133000 |  -10000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       128000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 16. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 545067 |      2 |      1.45 |        0 |    87000 |        0 |   60000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        60000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 17. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 010004 |      1 | 1.4444444 |        0 |   650000 |        0 |  450000 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       450000                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 18. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 500225 |      2 | 1.4403292 |        0 |   100000 |   -75000 |  159000 |  -75000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                       121500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 19. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 546043 |      0 |      1.44 |        0 |    90000 |        0 |   62500 |       0 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                        62500                                     |
     +----------------------------------------------------------------------------------+

     +----------------------------------------------------------------------------------+
 20. |   hhid | rsubhh | r_res_2~d | yc_res~2 | cg_res.. | F_res_~2 |  A_2020 |  F_2022 |
     | 915367 |      0 |      1.44 |        0 |  1070000 |  -550000 | 1400000 | -550000 |
     |----------------------------------------------------------------------------------|
     |                                     denom_..                                     |
     |                                      1125000                                     |
     +----------------------------------------------------------------------------------+

. 
. * ---------------------------------------------------------------------
. * Zero-value checks
. * ---------------------------------------------------------------------
. di as txt "=== Zero-value analysis ==="
=== Zero-value analysis ===

. 
. quietly count if yc_res_2022 == 0 & res_sample

. di as txt "Households with zero interest income: " r(N)
Households with zero interest income: 4706

. quietly count if cg_res_2022 == 0 & res_sample

. di as txt "Households with zero capital gains: " r(N)
Households with zero capital gains: 802

. quietly count if F_res_2022 == 0 & res_sample

. di as txt "Households with zero residential flows: " r(N)
Households with zero residential flows: 3168

. 
. * ---------------------------------------------------------------------
. * Save results
. * ---------------------------------------------------------------------
. di as txt "=== Saving results ==="
=== Saving results ===

. 
. save "`master'", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/hrs_rand_2020_2022_mast
    > er.dta saved

. di as txt "Saved residential housing return variables to master: `master'"
Saved residential housing return variables to master: /Volumes/SSD PRO/Github-forks/Chp2-Belie
> fsandTrust/Code/Data/HRS_RAND/cleaned/hrs_rand_2020_2022_master.dta

. 
. * List of variables created
. di as txt "Variables created:"
Variables created:

. di as txt "  res_sample: sample indicator"
  res_sample: sample indicator

. di as txt "  A_2020: beginning period net worth"
  A_2020: beginning period net worth

. di as txt "  F_2022: total net investment flows"
  F_2022: total net investment flows

. di as txt "  denom_res_2022: final denominator"
  denom_res_2022: final denominator

. di as txt "  yc_res_2022: interest income (always 0)"
  yc_res_2022: interest income (always 0)

. di as txt "  cg_res_2022: capital gains"
  cg_res_2022: capital gains

. di as txt "  F_res_2022: residential flows"
  F_res_2022: residential flows

. di as txt "  r_res_2022: raw returns"
  r_res_2022: raw returns

. di as txt "  r_res_2022_trimmed: trimmed returns"
  r_res_2022_trimmed: trimmed returns

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_RAND/cleaned/com
> pute_residential_returns_2022.log
  log type:  text
 closed on:  29 Sep 2025, 11:57:43
----------------------------------------------------------------------------------------------
