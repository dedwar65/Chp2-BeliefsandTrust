------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/randhrs
> 1992_2022v1_STATA/prep_controls.log
  log type:  text
 opened on:   2 Oct 2025, 13:24:23

. 
. set more off

. 
. * ---------------------------------------------------------------------
. * File paths
. * ---------------------------------------------------------------------
. * Work on the unified analysis dataset produced by trust-merge (or create if missing)
. local in  "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/randhrs
> 1992_2022v1_STATA/randhrs1992_2022v1_analysis.dta"

. local fallback "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/ra
> ndhrs1992_2022v1_STATA/randhrs1992_2022v1_with_flows.dta"

. local out "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/randhrs
> 1992_2022v1_STATA/randhrs1992_2022v1_analysis.dta"

. 
. * ---------------------------------------------------------------------
. * Load data
. * ---------------------------------------------------------------------
. di as txt "=== Loading longitudinal file ==="
=== Loading longitudinal file ===

. capture confirm file "`in'"

. if _rc {
.     di as txt "Analysis dataset not found; falling back to flows dataset and will write 
> unified file."
.     capture confirm file "`fallback'"
.     if _rc {
.         di as error "ERROR: Neither analysis nor flows dataset found. Run long_merge_in.
> do first."
.         exit 198
.     }
.     use "`fallback'", clear
. }

. else {
.     use "`in'", clear
. }

. 
. quietly describe

. di as txt "Observations: " %9.0f r(N)
Observations:     12168

. di as txt "Variables:    " %9.0f r(k)
Variables:        19943

. 
. * ---------------------------------------------------------------------
. * Marital status: married vs not married
. * ---------------------------------------------------------------------
. di as txt "=== Constructing marital status dummy from r15mstat ==="
=== Constructing marital status dummy from r15mstat ===

. capture confirm variable r15mstat

. if _rc {
.     di as error "ERROR: r15mstat not found"
.     exit 198
. }

. 
. capture drop married_2020

. gen byte married_2020 = .
(12,168 missing values generated)

. replace married_2020 = 1 if inlist(r15mstat, 1, 2)
(6,768 real changes made)

. replace married_2020 = 0 if inlist(r15mstat, 3, 4, 5, 6, 7, 8)
(5,374 real changes made)

. label define yesno 0 "not married" 1 "married", replace

. label values married_2020 yesno

. label var married_2020 "Married (r15mstat: 1 or 2) vs not married (3-8)"

. 
. di as txt "Marital status (r15mstat) distribution:"
Marital status (r15mstat) distribution:

. tab r15mstat, missing

   r15mstat:w15 r marital |
                   status |      Freq.     Percent        Cum.
--------------------------+-----------------------------------
                1.married |      6,671       54.82       54.82
  2.married,spouse absent |         97        0.80       55.62
              3.partnered |        754        6.20       61.82
              4.separated |        263        2.16       63.98
               5.divorced |      1,648       13.54       77.52
                7.widowed |      1,908       15.68       93.20
          8.never married |        801        6.58       99.79
.j=web interview, missing |          8        0.07       99.85
               .m=missing |         18        0.15      100.00
--------------------------+-----------------------------------
                    Total |     12,168      100.00

. 
. di as txt "Married_2020 dummy summary:"
Married_2020 dummy summary:

. tab married_2020, missing

    Married |
 (r15mstat: |
 1 or 2) vs |
not married |
      (3-8) |      Freq.     Percent        Cum.
------------+-----------------------------------
not married |      5,374       44.17       44.17
    married |      6,768       55.62       99.79
          . |         26        0.21      100.00
------------+-----------------------------------
      Total |     12,168      100.00

. 
. * ---------------------------------------------------------------------
. * Immigration status: born in US dummy from rabplacf/rabplace
. * ---------------------------------------------------------------------
. di as txt "=== Constructing born-in-US dummy from rabplacf/rabplace ==="
=== Constructing born-in-US dummy from rabplacf/rabplace ===

. local immvar ""

. capture confirm variable rabplacf

. if !_rc {
.     local immvar "rabplacf"
. }

. else {
.     capture confirm variable rabplace
.     if !_rc {
.         local immvar "rabplace"
.     }
. }

. if "`immvar'" == "" {
.     di as error "ERROR: immigration place variable (rabplacf/rabplace) not found"
.     exit 198
. }

. 
. capture drop born_us

. gen byte born_us = .
(12,168 missing values generated)

. * 1-10 are US Census divisions; 12=US territory => treat as US-born
. replace born_us = 1 if inrange(`immvar',1,10) | `immvar' == 12
(34 real changes made)

. * 11=Not US or US territory; 13=Not US => not US-born
. replace born_us = 0 if inlist(`immvar',11,13)
(0 real changes made)

. label values born_us yesno

. label var born_us "Born in US (1) vs not US (0)"

. 
. di as txt "Immigration raw distribution (`immvar'):"
Immigration raw distribution (rabplacf):

. tab `immvar', missing

                    rabplacf: flag diff |
                   rabplace/usborn(trk) |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                       0.no discrepancy |     12,134       99.72       99.72
               2.trk=not us/rabplace=us |          1        0.01       99.73
3.trk=miss/rabplace=valid census divisi |          1        0.01       99.74
4.trk=any/rabplace=us territory or out  |         32        0.26      100.00
----------------------------------------+-----------------------------------
                                  Total |     12,168      100.00

. di as txt "Born-in-US dummy summary:"
Born-in-US dummy summary:

. tab born_us, missing

 Born in US |
 (1) vs not |
     US (0) |      Freq.     Percent        Cum.
------------+-----------------------------------
    married |         34        0.28        0.28
          . |     12,134       99.72      100.00
------------+-----------------------------------
      Total |     12,168      100.00

. 
. * ---------------------------------------------------------------------
. * Save back to unified analysis dataset
. * ---------------------------------------------------------------------
. di as txt "=== Saving unified analysis dataset (includes flows, trust, controls) ==="
=== Saving unified analysis dataset (includes flows, trust, controls) ===

. save "`out'", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/randhrs1992_2022v1_STATA/ra
    > ndhrs1992_2022v1_analysis.dta saved

. di as txt "Saved unified dataset: `out'"
Saved unified dataset: /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Lo
> ng/randhrs1992_2022v1_STATA/randhrs1992_2022v1_analysis.dta

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS_Long/randhrs
> 1992_2022v1_STATA/prep_controls.log
  log type:  text
 closed on:   2 Oct 2025, 13:24:23
------------------------------------------------------------------------------------------
