--------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS/cleaned/
> compute_interest_dividends_2022.log
  log type:  text
 opened on:  23 Sep 2025, 09:09:47

. 
. set more off

. 
. local master "/Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS/clean
> ed/hrs_2020_2022_master.dta"

. capture confirm file "`master'"

. if _rc {
.     di as error "ERROR: master file not found -> `master'"
.     exit 198
. }

. 
. use "`master'", clear

. di as txt "Using master file: `master'"
Using master file: /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS/cl
> eaned/hrs_2020_2022_master.dta

. 
. * ---------------------------------------------------------------------
. * Helper note:
. * We will create for each frequency variable a multiplier var named <fq>_mult
. * and optionally a label var <fq>_lbl (if decode(value label) exists).
. * We'll create per-asset interest vars named:
. *   int_<asset>_2022
. * and a total int_total_2022
. * ---------------------------------------------------------------------
. 
. * ---------------------------
. * 2022: pairs (freq, amount)
. * ---------------------------
. local f2022_re   SQ139

. local a2022_re   SQ141

. 
. local f2022_bus  SQ153

. local a2022_bus  SQ155

. 
. local f2022_ira  SQ194

. local a2022_ira  SQ190

. 
. local f2022_stk  SQ322

. local a2022_stk  SQ324

. 
. local f2022_bnd  SQ336

. local a2022_bnd  SQ338

. 
. local f2022_cash SQ350

. local a2022_cash SQ352

. 
. local f2022_cds  SQ362

. local a2022_cds  SQ364

. 
. * ---------------------------------------------------------------------
. * Recode frequency codes 7,8,9 -> missing ONLY for the frequency variables
. * ---------------------------------------------------------------------
. local freqvars "`f2022_re' `f2022_bus' `f2022_ira' `f2022_stk' `f2022_bnd' `f2022_ca
> sh' `f2022_cds'"

. 
. di as txt "Recoding frequency codes 7/8/9 -> missing for 2022 frequency variables (o
> nly)."
Recoding frequency codes 7/8/9 -> missing for 2022 frequency variables (only).

. foreach v of local freqvars {
  2.     capture confirm variable `v'
  3.     if _rc {
  4.         di as txt "  Variable `v' not found in dataset -- skipping"
  5.     }
  6.     else {
  7.         capture confirm numeric variable `v'
  8.         if _rc {
  9.             di as txt "  Variable `v' is not numeric -- skipping recode (check ty
> pe)."
 10.         }
 11.         else {
 12.             quietly count if inlist(`v',7,8,9)
 13.             di as txt "  `v' records with codes 7/8/9 before recode = " r(N)
 14.             quietly replace `v' = . if inlist(`v',7,8,9)
 15.             quietly count if inlist(`v',7,8,9)
 16.             di as txt "  `v' records with codes 7/8/9 after recode  = " r(N)
 17.         }
 18.     }
 19. }
  SQ139 records with codes 7/8/9 before recode = 16
  SQ139 records with codes 7/8/9 after recode  = 0
  SQ153 records with codes 7/8/9 before recode = 89
  SQ153 records with codes 7/8/9 after recode  = 0
  SQ194 records with codes 7/8/9 before recode = 3
  SQ194 records with codes 7/8/9 after recode  = 0
  SQ322 records with codes 7/8/9 before recode = 222
  SQ322 records with codes 7/8/9 after recode  = 0
  SQ336 records with codes 7/8/9 before recode = 45
  SQ336 records with codes 7/8/9 after recode  = 0
  SQ350 records with codes 7/8/9 before recode = 326
  SQ350 records with codes 7/8/9 after recode  = 0
  SQ362 records with codes 7/8/9 before recode = 116
  SQ362 records with codes 7/8/9 after recode  = 0

. 
. * ---------------------------------------------------------------------
. * Asset-specific frequency -> annual multiplier mappings (wave-accurate)
. * Mirrors the corrected RAND mappings, adapted to HRS variable names
. * ---------------------------------------------------------------------
. 
. di as txt "=== Mapping 2022 frequency variables (asset-specific rules) ==="
=== Mapping 2022 frequency variables (asset-specific rules) ===

. 
. * --- Rental income (SQ139): 1=weekly, 2=2x/month, 3=monthly, 4=quarterly, 5=6mo, 6=
> yearly
. capture drop `f2022_re'_mult

. gen double `f2022_re'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_re'_mult = 52 if `f2022_re' == 1

. quietly replace `f2022_re'_mult = 24 if `f2022_re' == 2

. quietly replace `f2022_re'_mult = 12 if `f2022_re' == 3

. quietly replace `f2022_re'_mult = 4  if `f2022_re' == 4

. quietly replace `f2022_re'_mult = 2  if `f2022_re' == 5

. quietly replace `f2022_re'_mult = 1  if `f2022_re' == 6

. di as txt "`f2022_re'_mult nonmissing observations = " _N - sum(missing(`f2022_re'_m
> ult))
SQ139_mult nonmissing observations = 14275

. 
. * --- Business income (SQ153): same mapping as rental
. capture drop `f2022_bus'_mult

. gen double `f2022_bus'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_bus'_mult = 52 if `f2022_bus' == 1

. quietly replace `f2022_bus'_mult = 24 if `f2022_bus' == 2

. quietly replace `f2022_bus'_mult = 12 if `f2022_bus' == 3

. quietly replace `f2022_bus'_mult = 4  if `f2022_bus' == 4

. quietly replace `f2022_bus'_mult = 2  if `f2022_bus' == 5

. quietly replace `f2022_bus'_mult = 1  if `f2022_bus' == 6

. di as txt "`f2022_bus'_mult nonmissing observations = " _N - sum(missing(`f2022_bus'
> _mult))
SQ153_mult nonmissing observations = 14275

. 
. * --- IRA annuity frequency (SQ194): 3=monthly, 4=quarterly, 5=6mo, 6=yearly
. capture drop `f2022_ira'_mult

. gen double `f2022_ira'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_ira'_mult = 12 if `f2022_ira' == 3

. quietly replace `f2022_ira'_mult = 4  if `f2022_ira' == 4

. quietly replace `f2022_ira'_mult = 2  if `f2022_ira' == 5

. quietly replace `f2022_ira'_mult = 1  if `f2022_ira' == 6

. di as txt "`f2022_ira'_mult nonmissing observations = " _N - sum(missing(`f2022_ira'
> _mult))
SQ194_mult nonmissing observations = 14275

. 
. * --- Stock dividends (SQ322): 1=accumulates (map to 0), 3=monthly, 4=quarterly, 5=6
> mo, 6=yearly
. capture drop `f2022_stk'_mult

. gen double `f2022_stk'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_stk'_mult = 0  if `f2022_stk' == 1

. quietly replace `f2022_stk'_mult = 12 if `f2022_stk' == 3

. quietly replace `f2022_stk'_mult = 4  if `f2022_stk' == 4

. quietly replace `f2022_stk'_mult = 2  if `f2022_stk' == 5

. quietly replace `f2022_stk'_mult = 1  if `f2022_stk' == 6

. di as txt "`f2022_stk'_mult nonmissing observations = " _N - sum(missing(`f2022_stk'
> _mult))
SQ322_mult nonmissing observations = 14275

. 
. * --- Bond interest (SQ336): same as stocks (1 accumulates -> 0)
. capture drop `f2022_bnd'_mult

. gen double `f2022_bnd'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_bnd'_mult = 0  if `f2022_bnd' == 1

. quietly replace `f2022_bnd'_mult = 12 if `f2022_bnd' == 3

. quietly replace `f2022_bnd'_mult = 4  if `f2022_bnd' == 4

. quietly replace `f2022_bnd'_mult = 2  if `f2022_bnd' == 5

. quietly replace `f2022_bnd'_mult = 1  if `f2022_bnd' == 6

. di as txt "`f2022_bnd'_mult nonmissing observations = " _N - sum(missing(`f2022_bnd'
> _mult))
SQ336_mult nonmissing observations = 14275

. 
. * --- Checking/savings interest (SQ350): same as stocks (1 accumulates -> 0)
. capture drop `f2022_cash'_mult

. gen double `f2022_cash'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_cash'_mult = 0  if `f2022_cash' == 1

. quietly replace `f2022_cash'_mult = 12 if `f2022_cash' == 3

. quietly replace `f2022_cash'_mult = 4  if `f2022_cash' == 4

. quietly replace `f2022_cash'_mult = 2  if `f2022_cash' == 5

. quietly replace `f2022_cash'_mult = 1  if `f2022_cash' == 6

. di as txt "`f2022_cash'_mult nonmissing observations = " _N - sum(missing(`f2022_cas
> h'_mult))
SQ350_mult nonmissing observations = 14275

. 
. * --- CDs/T-bills/gov bonds (SQ362): same as stocks (1 accumulates -> 0)
. capture drop `f2022_cds'_mult

. gen double `f2022_cds'_mult = .
(14,276 missing values generated)

. quietly replace `f2022_cds'_mult = 0  if `f2022_cds' == 1

. quietly replace `f2022_cds'_mult = 12 if `f2022_cds' == 3

. quietly replace `f2022_cds'_mult = 4  if `f2022_cds' == 4

. quietly replace `f2022_cds'_mult = 2  if `f2022_cds' == 5

. quietly replace `f2022_cds'_mult = 1  if `f2022_cds' == 6

. di as txt "`f2022_cds'_mult nonmissing observations = " _N - sum(missing(`f2022_cds'
> _mult))
SQ362_mult nonmissing observations = 14275

. 
. * ---------------------------------------------------------------------
. * Compute per-asset interest for 2022 when both amount & multiplier exist
. * ---------------------------------------------------------------------
. cap drop int_re_2022 int_bus_2022 int_ira_2022 int_stk_2022 int_bnd_2022 int_cash_20
> 22 int_cds_2022

. 
. di as txt "=== Computing 2022 interest/dividends per asset ==="
=== Computing 2022 interest/dividends per asset ===

. 
. gen double int_re_2022 = .
(14,276 missing values generated)

. replace int_re_2022 = `a2022_re' * `f2022_re'_mult if !missing(`a2022_re') & !missin
> g(`f2022_re'_mult)
(492 real changes made)

. di as txt "Real estate (2022) summary:"
Real estate (2022) summary:

. summarize int_re_2022, detail

                         int_re_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%         3600              0
10%         6000              0       Obs                 492
25%        10110              0       Sum of wgt.         492

50%        18660                      Mean           40018.46
                        Largest       Std. dev.      74396.15
75%        36000         372000
90%        84000         504000       Variance       5.53e+09
95%       168000         600000       Skewness       6.316775
99%       360000         960000       Kurtosis       61.16649

. 
. gen double int_bus_2022 = .
(14,276 missing values generated)

. replace int_bus_2022 = `a2022_bus' * `f2022_bus'_mult if !missing(`a2022_bus') & !mi
> ssing(`f2022_bus'_mult)
(212 real changes made)

. di as txt "Private business (2022) summary:"
Private business (2022) summary:

. summarize int_bus_2022, detail

                        int_bus_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%          300              0
10%         2040              0       Obs                 212
25%        15000              0       Sum of wgt.         212

50%        36000                      Mean           81189.09
                        Largest       Std. dev.      134748.3
75%        78000         540000
90%       192000         600000       Variance       1.82e+10
95%       348000         936000       Skewness       3.747136
99%       600000         960000       Kurtosis       20.29091

. 
. gen double int_ira_2022 = .
(14,276 missing values generated)

. replace int_ira_2022 = `a2022_ira' * `f2022_ira'_mult if !missing(`a2022_ira') & !mi
> ssing(`f2022_ira'_mult)
(15 real changes made)

. di as txt "IRA (2022) summary:"
IRA (2022) summary:

. summarize int_ira_2022, detail

                        int_ira_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%          840            840
 5%          840           2100
10%         2100           5256       Obs                  15
25%         6900           6900       Sum of wgt.          15

50%         8400                      Mean            24362.8
                        Largest       Std. dev.      47836.11
75%        18000          18000
90%        48500          26246       Variance       2.29e+09
95%       192000          48500       Skewness       3.150377
99%       192000         192000       Kurtosis       11.56414

. 
. gen double int_stk_2022 = .
(14,276 missing values generated)

. replace int_stk_2022 = `a2022_stk' * `f2022_stk'_mult if !missing(`a2022_stk') & !mi
> ssing(`f2022_stk'_mult)
(453 real changes made)

. di as txt "Stocks (2022) summary:"
Stocks (2022) summary:

. summarize int_stk_2022, detail

                        int_stk_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            4              0       Obs                 453
25%          120              0       Sum of wgt.         453

50%         1080                      Mean           15513.62
                        Largest       Std. dev.      74403.68
75%         8000         480000
90%        24000         520000       Variance       5.54e+09
95%        49800         596000       Skewness       11.38977
99%       240000        1200000       Kurtosis       159.1124

. 
. gen double int_bnd_2022 = .
(14,276 missing values generated)

. replace int_bnd_2022 = `a2022_bnd' * `f2022_bnd'_mult if !missing(`a2022_bnd') & !mi
> ssing(`f2022_bnd'_mult)
(58 real changes made)

. di as txt "Bonds (2022) summary:"
Bonds (2022) summary:

. summarize int_bnd_2022, detail

                        int_bnd_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs                  58
25%          300              0       Sum of wgt.          58

50%         3920                      Mean           24864.28
                        Largest       Std. dev.      83534.46
75%        12000          80000
90%        40000         120000       Variance       6.98e+09
95%       120000         204000       Skewness       5.968566
99%       600000         600000       Kurtosis       40.52969

. 
. gen double int_cash_2022 = .
(14,276 missing values generated)

. replace int_cash_2022 = `a2022_cash' * `f2022_cash'_mult if !missing(`a2022_cash') &
>  !missing(`f2022_cash'_mult)
(1,831 real changes made)

. di as txt "Checking/savings (2022) summary:"
Checking/savings (2022) summary:

. summarize int_cash_2022, detail

                        int_cash_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               1,831
25%           12              0       Sum of wgt.       1,831

50%           40                      Mean           1758.087
                        Largest       Std. dev.      23201.09
75%          240         144000
90%         1080         240000       Variance       5.38e+08
95%         3200         600000       Skewness       26.36781
99%        21600         720000       Kurtosis        750.866

. 
. gen double int_cds_2022 = .
(14,276 missing values generated)

. replace int_cds_2022 = `a2022_cds' * `f2022_cds'_mult if !missing(`a2022_cds') & !mi
> ssing(`f2022_cds'_mult)
(153 real changes made)

. di as txt "CDS/t-bills (2022) summary:"
CDS/t-bills (2022) summary:

. summarize int_cds_2022, detail

                        int_cds_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs                 153
25%           10              0       Sum of wgt.         153

50%          240                      Mean           2402.784
                        Largest       Std. dev.      7957.554
75%         1200          32000
90%         3600          36000       Variance       6.33e+07
95%        12000          40000       Skewness       6.071186
99%        40000          72000       Kurtosis       45.67572

. 
. egen double int_total_2022 = rowtotal(int_re_2022 int_bus_2022 int_ira_2022 int_stk_
> 2022 int_bnd_2022 int_cash_2022 int_cds_2022)

. di as txt "TOTAL interest/dividends 2022 summary (sum across asset classes):"
TOTAL interest/dividends 2022 summary (sum across asset classes):

. summarize int_total_2022, detail

                       int_total_2022
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs              14,276
25%            0              0       Sum of wgt.      14,276

50%            0                      Mean           3454.966
                        Largest       Std. dev.       33744.4
75%            0         960000
90%          120         960000       Variance       1.14e+09
95%         7236        1026000       Skewness       24.73748
99%        73320        1800012       Kurtosis       884.8956

. tabstat int_total_2022, stats(n mean sd p50 min max) format(%12.2f)

    Variable |            N         Mean           SD          p50          Min
-------------+-----------------------------------------------------------------
int_tot~2022 |     14276.00      3454.97     33744.40         0.00         0.00
-------------------------------------------------------------------------------

    Variable |          Max
-------------+-------------
int_tot~2022 |   1800012.00
---------------------------

. 
. * ---------------------------------------------------------------------
. * Diagnostics: find cases where amount exists but multiplier missing (2022)
. * ---------------------------------------------------------------------
. di as txt "=== Diagnostics: amount present but freq multiplier missing (2022) ==="
=== Diagnostics: amount present but freq multiplier missing (2022) ===

. foreach pair in ///
>     "`f2022_re' `a2022_re' int_re_2022" ///
>     "`f2022_bus' `a2022_bus' int_bus_2022" ///
>     "`f2022_ira' `a2022_ira' int_ira_2022" ///
>     "`f2022_stk' `a2022_stk' int_stk_2022" ///
>     "`f2022_bnd' `a2022_bnd' int_bnd_2022" ///
>     "`f2022_cash' `a2022_cash' int_cash_2022" ///
>     "`f2022_cds' `a2022_cds' int_cds_2022" {
  2.     local fq : word 1 of `pair'
  3.     local amt : word 2 of `pair'
  4.     local intv : word 3 of `pair'
  5.     di as txt "---- `intv' (amount var `amt' ; freq var `fq')"
  6.     quietly tab `fq', missing
  7.     quietly count if !missing(`amt') & missing(`fq'_mult)
  8.     di as txt "Records with amount but missing multiplier = " r(N)
  9.     quietly list HHID RSUBHH `fq' `amt' in 1/10 if !missing(`amt') & missing(`fq'
> _mult)
 10. }
---- int_re_2022 (amount var SQ141 ; freq var SQ139)
Records with amount but missing multiplier = 0
---- int_bus_2022 (amount var SQ155 ; freq var SQ153)
Records with amount but missing multiplier = 0
---- int_ira_2022 (amount var SQ190 ; freq var SQ194)
Records with amount but missing multiplier = 51
---- int_stk_2022 (amount var SQ324 ; freq var SQ322)
Records with amount but missing multiplier = 0
---- int_bnd_2022 (amount var SQ338 ; freq var SQ336)
Records with amount but missing multiplier = 0
---- int_cash_2022 (amount var SQ352 ; freq var SQ350)
Records with amount but missing multiplier = 0
---- int_cds_2022 (amount var SQ364 ; freq var SQ362)
Records with amount but missing multiplier = 0

. 
. * ---------------------------------------------------------------------
. * Save dataset with new computed variables BACK TO MASTER (overwrite)
. * ---------------------------------------------------------------------
. save "`master'", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS/cleaned/hrs_2020_2022_master
    > .dta saved

. di as txt "Saved 2022 interest/dividend vars back to master: `master'"
Saved 2022 interest/dividend vars back to master: /Volumes/SSD PRO/Github-forks/Chp2-B
> eliefsandTrust/Code/Data/HRS/cleaned/hrs_2020_2022_master.dta

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-BeliefsandTrust/Code/Data/HRS/cleaned/
> compute_interest_dividends_2022.log
  log type:  text
 closed on:  23 Sep 2025, 09:09:47
--------------------------------------------------------------------------------------
